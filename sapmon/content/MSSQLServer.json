{
	"contentVersion": "0.4.0",
	"checks":
	[
		{
			"name": "DBConnections",
			"description": "SQL Server DB Connections",
			"customLog": "MSSQL_DBConnections",
			"frequencySecs": 60,
			"includeInCustomerAnalytics": true,
			"actions":
			[
				{
					"type": "ExecuteSql",
					"parameters": {
						"sql": "select name,user_access_desc,(select count(distinct session_id) from sys.dm_exec_sessions as des where des.database_id = sdb.database_id and program_name like 'R3%') as SAPConnections,(select count(distinct session_id) from sys.dm_exec_sessions as des where des.database_id = sdb.database_id and (program_name not like 'R3%' or program_name is null)) as NonSAPConnections, (select count(distinct login_name) from sys.dm_exec_sessions as des where des.database_id = sdb.database_id) as UniqueUser,(select count(distinct session_id) from sys.dm_exec_sessions as des where des.database_id = sdb.database_id and is_user_process = 0) as SystemConnections,(select count(distinct session_id) from sys.dm_exec_sessions as des where des.database_id = sdb.database_id and is_user_process = 1) as UserConnections from master.sys.databases sdb"
					}
				},
			]
		},
		{
			"name": "BlockingProcesses",
			"description": "SQL Server blocking processes",
			"customLog": "MSSQL_BlockingProcesses",
			"frequencySecs": 60,
			"includeInCustomerAnalytics": true,
			"actions":
			[
				{
					"type": "ExecuteSql",
					"parameters": {
						"sql": "select 	'blocked' as type,spid,kpid,blocked,cmd,waittime,lastwaittype,waitresource,	dbid,uid,cpu,physical_io,memusage,login_time,last_batch,ecid,open_tran,status,	hostname,program_name,hostprocess,sql_handle from sys.sysprocesses where (blocked != 0 and blocked != spid) union all select 'BLOCKER',spid,kpid,blocked,cmd,waittime,lastwaittype,waitresource,	dbid,uid,cpu,physical_io,memusage,login_time,last_batch,ecid,open_tran,status, hostname,program_name,hostprocess,sql_handle from sys.sysprocesses  where (spid in (select distinct blocked from sys.sysprocesses where blocked != 0 and blocked != spid) and blocked != spid)"
					}
				}
			]
		},
		{
			"name": "SystemProperties",
			"description": "SQL Server System properties",
			"customLog": "MSSQL_SystemProps",
			"frequencySecs": 3600,
			"includeInCustomerAnalytics": true,
			"actions": 
			[
				{
					"type": "ExecuteSql",
					"parameters": {  
						"sql": "select N'BuildClrVersion' as Setting, serverproperty(N'BuildClrVersion') as Value union select N'Collation', serverproperty(N'Collation') union select N'CollationID', serverproperty(N'CollationID') union select N'ComparisonStyle', serverproperty(N'ComparisonStyle') union select N'ComputerNamePhysicalNetBIOS', serverproperty(N'ComputerNamePhysicalNetBIOS') union select N'Edition', serverproperty(N'Edition') union select N'EditionID', serverproperty(N'EditionID') union select N'EngineEdition', serverproperty(N'EngineEdition') union select N'HadrManagerStatus', serverproperty(N'HadrManagerStatus') union select N'InstanceName', serverproperty(N'InstanceName') union select N'IsClustered', serverproperty(N'IsClustered') union select N'IsFullTextInstalled', serverproperty(N'IsFullTextInstalled') union select N'IsHadrEnabled', serverproperty(N'IsHadrEnabled') union select N'IsIntegratedSecurityOnly', serverproperty(N'IsIntegratedSecurityOnly') union select N'IsLocalDB', serverproperty(N'IsLocalDB') union select N'IsSingleUser', serverproperty(N'IsSingleUser') union select N'LCID', serverproperty(N'LCID') union select N'MachineName', serverproperty(N'MachineName') union select N'NumLicenses', serverproperty(N'NumLicenses') union select N'ProcessID', serverproperty(N'ProcessID') union select N'ProductVersion', serverproperty(N'ProductVersion') union select N'ProductLevel', serverproperty(N'ProductLevel') union select N'ResourceLastUpdateDateTime', serverproperty(N'ResourceLastUpdateDateTime') union select N'ResourceVersion', serverproperty(N'ResourceVersion') union select N'ServerName', serverproperty(N'ServerName') union select N'SqlCharSet', serverproperty(N'SqlCharSet') union select N'SqlCharSetName', serverproperty(N'SqlCharSetName') union select N'SqlSortOrder', serverproperty(N'SqlSortOrder') union select N'SqlSortOrderName', serverproperty(N'SqlSortOrderName') union select N'FilestreamShareName', serverproperty(N'FilestreamShareName') union select N'FilestreamConfiguredLevel', serverproperty(N'FilestreamConfiguredLevel') union select N'FilestreamEffectiveLevel', serverproperty(N'FilestreamEffectiveLevel')"
					}
				}
			]
		}
	]
}
